# Docker Compose setup for automated organize files
#
# Add this service to your existing docker-compose.yml file
# or create a new file called docker-compose.cron.yml

services:
  navidrome-organize-cron:
    build: .
    container_name: navidrome-organize-cron
    restart: unless-stopped
    environment:
      - PYTHONPATH=/app
      - TZ=UTC  # Set your timezone
    volumes:
      - ./:/app
      - /media/Owned:/media/Owned
      - /media/Not_Owned:/media/Not_Owned
      - /media/Incomplete:/media/Incomplete
      - /downloads/completed:/downloads/completed
      - ./data:/data
      - ./logs:/app/logs:rw
    working_dir: /app
    command: >
      sh -c "
        echo '5 * * * * cd /app && python scripts/organise_files.py --auto-mode >> /app/logs/organize_cron.log 2>&1' > /tmp/crontab &&
        crontab /tmp/crontab &&
        crond -f -l 2
      "
    # Alternative: use a more robust cron setup
    # command: >
    #   sh -c "
    #     apk add --no-cache dcron &&
    #     echo '5 * * * * cd /app && python scripts/organise_files.py --auto-mode >> /app/logs/organize_cron.log 2>&1' > /var/spool/cron/crontabs/root &&
    #     chmod 600 /var/spool/cron/crontabs/root &&
    #     crond -f -d 8
    #   "
    networks:
      - navidrome-cleanup-network

networks:
  navidrome-cleanup-network:
    driver: bridge

# Usage:
# docker-compose -f docker-compose.cron.yml up -d